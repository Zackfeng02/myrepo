<!DOCTYPE html>
<html>
<head>
    <title>Customer Overview</title>
    <link rel="stylesheet" href="/styles.css">
    <link href="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
</head>
<body>
    <div class="container">
        <div th:insert="~{fragments :: navbar}"></div>
    
        <!-- Customer Information -->
        <h2 class="mt-4 mb-3">Personal Information</h2>
        <div id="customerInfo" class="mb-4">
            <!-- Customer details will be populated here -->
        </div>

        <!-- Account Information -->
        <h2 class="mt-4">Account Information</h2>
        <table class="table table-bordered" id="accountTable">
            <thead>
                <tr>
                    <th>ID</th>
                    <th>Account Type</th>
                    <th>Balance</th>
                    <th>Overdraft Limit</th>
                    <th>Actions</th>
                </tr>
            </thead>
            <tbody>
                <!-- Account details will be populated here -->
            </tbody>
        </table>
        <a href="/acc_overview/new" class="btn btn-primary">Create New Account</a>
    </div>

    <script>
        $(document).ready(function() {
            var customerId = customer.customerId;

            // Fetch customer details
            $.ajax({
                url: '/api/customers/' + customerId, 
                method: 'GET',
                success: function(customer) {
                    populateCustomerInfo(customer);
                },
                error: function(error) {
                    console.error("Error fetching customer details:", error);
                }
            });

            // Fetch account details
            $.ajax({
                url: '/api/accounts/customer/' + customerId, 
                method: 'GET',
                success: function(accounts) {
                    populateAccountTable(accounts);
                },
                error: function(error) {
                    console.error("Error fetching account details:", error);
                }
            });
        });

		function populateCustomerInfo(customer) {
		    var customerInfoHtml = '<div class="row">' +
		        '<div class="col-md-2 font-weight-bold">ID:</div>' +
		        '<div class="col-md-10">' + customer.customerId + '</div>' +
		        '<div class="col-md-2 font-weight-bold">Username:</div>' +
		        '<div class="col-md-10">' + customer.username + '</div>' +
		        '<div class="col-md-2 font-weight-bold">First Name:</div>' +
		        '<div class="col-md-10">' + customer.firstname + '</div>' +
		        '<div class="col-md-2 font-weight-bold">Last Name:</div>' +
		        '<div class="col-md-10">' + customer.lastname + '</div>' +
		        '<div class="col-md-2 font-weight-bold">Address:</div>' +
		        '<div class="col-md-10">' + customer.address + '</div>' +
		        '<div class="col-md-2 font-weight-bold">City:</div>' +
		        '<div class="col-md-10">' + customer.city + '</div>' +
		        '<div class="col-md-2 font-weight-bold">Postal Code:</div>' +
		        '<div class="col-md-10">' + customer.postalcode + '</div>' +
		        '<div class="col-md-2 font-weight-bold">Phone Number:</div>' +
		        '<div class="col-md-10">' + customer.phone_number + '</div>' +
		        '<div class="col-md-2 font-weight-bold">Email ID:</div>' +
		        '<div class="col-md-10">' + customer.emailId + '</div>' +
		        '</div>';
		    $('#customerInfo').html(customerInfoHtml);
		}



        function populateAccountTable(accounts) {
            var accountTableHtml = '';
            $.each(accounts, function(index, account) {
                accountTableHtml += '<tr>' +
                    '<td>' + account.accountNumber + '</td>' +
                    '<td>' + account.accountTypeCode + '</td>' +
                    '<td>' + account.balance + '</td>' +
                    '<td>' + account.overDraftLimit + '</td>' +
                    '<td>' +
                    '<a href="/acc_overview/view/' + account.accountNumber + '" class="text-primary">View</a> | ' +
                    '<a href="/acc_overview/edit/' + account.accountNumber + '" class="text-primary">Edit</a> | ' +
                    '<a href="/acc_overview/delete/' + account.accountNumber + '" class="text-danger">Delete</a>' +
                    '</td>' +
                    '</tr>';
            });
            $('#accountTable tbody').html(accountTableHtml);
        }
    </script>
</body>
</html>
